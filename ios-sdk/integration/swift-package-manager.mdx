---
title: "Swift Package Manager 集成"
description: "使用 Swift Package Manager 集成 SPAvatarKit SDK"
---

## 概述

Swift Package Manager (SPM) 是 Apple 官方推荐的包管理工具，也是集成 SPAvatarKit SDK 的推荐方式。

## 优势

- **自动依赖管理**: 自动处理依赖关系和版本冲突
- **版本控制**: 支持语义化版本控制
- **Xcode 集成**: 与 Xcode 深度集成，无需额外工具
- **安全性**: 支持包签名验证
- **性能**: 编译时优化，减少应用包大小

## 集成步骤

### 步骤 1: 添加包依赖

1. 在 Xcode 中打开您的项目
2. 选择 `File` → `Add Packages...`
3. 在搜索框中输入包地址：`https://github.com/your-org/SPAvatarKit.git`
4. 点击 `Add Package`

### 步骤 2: 选择版本规则

推荐使用以下版本规则：

- **Up to Next Major Version**: `~> 0.9` (推荐)
- **Up to Next Minor Version**: `~> 0.9.0`
- **Exact Version**: `0.9.2`

### 步骤 3: 选择目标

确保选择正确的目标项目：

- 选择您的主应用目标
- 如果使用多个目标，确保都选择了 SPAvatarKit

## 配置选项

### 版本规则说明

```swift
// 允许 0.9.x 版本，但不包括 1.0.0
"~> 0.9"

// 允许 0.9.2.x 版本，但不包括 0.9.3
"~> 0.9.2"

// 只使用特定版本
"0.9.2"
```

### 依赖解析

SPM 会自动解析依赖关系：

```swift
// SPAvatarKit 的依赖会自动处理
dependencies: [
    .package(url: "https://github.com/your-org/SPAvatarKit.git", from: "0.9.0")
]
```

## 常见问题

### 包无法找到

**问题**: 无法找到 SPAvatarKit 包

**解决方案**:
1. 检查网络连接
2. 验证包地址是否正确
3. 清理 Xcode 缓存
4. 重启 Xcode

### 版本冲突

**问题**: 出现版本冲突错误

**解决方案**:
1. 检查其他依赖是否与 SPAvatarKit 冲突
2. 更新到兼容版本
3. 联系技术支持

### 编译错误

**问题**: 集成后出现编译错误

**解决方案**:
1. 清理项目: `Product` → `Clean Build Folder`
2. 删除 `DerivedData` 文件夹
3. 重新拉取依赖包
4. 检查 Xcode 版本兼容性

## 最佳实践

### 版本管理

```swift
// 在 Package.swift 中指定版本范围
dependencies: [
    .package(url: "https://github.com/your-org/SPAvatarKit.git", .upToNextMajor(from: "0.9.0"))
]
```

### 依赖更新

定期更新依赖包：

1. 选择 `File` → `Add Packages...`
2. 在已添加的包列表中找到 SPAvatarKit
3. 点击更新按钮

### 锁定版本

在 CI/CD 环境中锁定版本：

```bash
# 生成 Package.resolved 文件
xcodebuild -resolvePackageDependencies
```

## 验证集成

### 检查集成状态

```swift
import SPAvatarKit

// 检查 SDK 是否正确导入
if AvatarSDK.isInitialized {
    print("✅ SPAvatarKit 集成成功")
} else {
    print("❌ SPAvatarKit 集成失败")
}
```

### 编译验证

确保项目能够正常编译：

```bash
# 命令行编译测试
xcodebuild -scheme YourApp -destination 'platform=iOS Simulator,name=iPhone 14' build
```

## 迁移指南

### 从 CocoaPods 迁移

如果您之前使用 CocoaPods，可以按以下步骤迁移：

1. 移除 Podfile 中的 SPAvatarKit 依赖
2. 运行 `pod deintegrate`
3. 使用 SPM 重新添加依赖
4. 更新导入语句（通常不需要更改）

### 从手动集成迁移

如果您之前手动集成框架：

1. 移除手动添加的框架文件
2. 清理 Build Settings 中的配置
3. 使用 SPM 添加依赖
4. 更新项目配置

## 故障排除

### 日志调试

启用详细日志帮助排查问题：

```swift
#if DEBUG
AvatarSDK.setLogLevel(.verbose)
#endif
```

### 网络问题

如果包下载失败：

1. 检查网络连接
2. 尝试使用 VPN
3. 清除 Xcode 缓存
4. 重启网络设备

### 权限问题

确保有足够的权限：

1. 检查 Xcode 权限设置
2. 确保网络访问权限
3. 检查防火墙设置 